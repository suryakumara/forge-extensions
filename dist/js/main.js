(()=>{"use strict";var e=function(e,t,n,o){var r=e*Math.PI/180,i=n*Math.PI/180,a=(n-e)*Math.PI/180,s=(o-t)*Math.PI/180,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,l,"next",e)}function l(e){r(a,o,i,s,l,"throw",e)}s(void 0)}))}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v(e);if(t){var r=v(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m(this,n)}}function m(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var f=function(e){c(n,Autodesk.Viewing.Extension);var t=h(n);function n(e,o){var r;return s(this,n),(r=t.call(this,e,o)).viewer=e,r.options=o,r._button=null,r._group=null,r.panel=null,r.grid=null,r}return u(n,[{key:"load",value:function(){return console.log("Docking Panel has been loaded !"),this.grid=new THREE.GridHelper(50,1),this.grid.material.opacity=.8,this.grid.material.transparent=!0,this.grid.position.set(0,0,0),this.grid.rotateX(Math.PI/2),this.viewer.overlays.hasScene("grid")||this.viewer.overlays.addScene("grid"),this.viewer.overlays.addMesh(this.grid,"grid"),!0}},{key:"unload",value:function(){return console.log("Docking Panel has been unloaded !"),null!==this.viewer.toolbar&&this.viewer.toolbar.removeControl(this.subToolbar),null!==this.panel&&this.panel.setVisible(!1),this._group&&(this._group.removeControl(this._button),0===this._group.getNumberOfControls()&&this.viewer.toolbar.removeControl(this._group)),!0}},{key:"onToolbarCreated",value:function(){var e=this;this._group=this.viewer.toolbar.getControl("BeeInventorToolbar"),this._group||(this._group=new Autodesk.Viewing.UI.ControlGroup("BeeInventorToolbar"),this.viewer.toolbar.addControl(this._group)),this._button=new Autodesk.Viewing.UI.Button("Docking Panel"),this._button.onClick=function(){null===e.panel&&(e.panel=new g(e.viewer,e.viewer.container,"beeInventor","My Custom Extension")),e.panel.setVisible(!e.panel.isVisible())},this._button.setToolTip("Docking Panel"),this._button.addClass("dockingPanel"),this._group.addControl(this._button)}}]),n}();Autodesk.Viewing.theExtensionManager.registerExtension("BeeInventor",f);var g=function(t){c(l,Autodesk.Viewing.UI.DockingPanel);var o,r=h(l);function l(t,n,o,i,u){var c;return s(this,l),a(p(c=r.call(this,n,o,i,u)),"multiplyMatrix",(function(e,t){for(var n=e.length,o=e[0].length,r=t[0].length,i=new Array(n),a=0;a<n;a+=1){i[a]=new Array(r);for(var s=0;s<r;s+=1){i[a][s]=0;for(var l=0;l<o;l+=1)i[a][s]+=e[a][l]*t[l][s]}}return i})),a(p(c),"getRotatedPosition",(function(e,t,n,o,r){var i=[e,t,[1,1,1,1]],a=[[1,0,-n],[0,1,-o],[0,0,1]],s=r*(Math.PI/180),l=[[Math.cos(s),-Math.sin(s),0],[Math.sin(s),Math.cos(s),0],[0,0,1]],u=[[1,0,n],[0,1,o],[0,0,1]],d=c.multiplyMatrix(u,l),h=c.multiplyMatrix(d,a);return[(i=c.multiplyMatrix(h,i))[0],i[1]]})),a(p(c),"calculateLatLong",(function(e,t,n,o){var r=Math.PI,i=e+o/1e3/6378*(180/r);return[t+n/1e3/6378*(180/r)/Math.cos(e*r/180),i]})),a(p(c),"setCoordinateBuilding",(function(){for(var e=[[0,0],[0,0],[0,0],[0,0]],t=0;t<c.BUILDING_CORNER_LOCATION.length;t+=1)e[t]=c.calculateLatLong(c.centerLat,c.centerLong,c.BUILDING_CORNER_LOCATION[t][0],c.BUILDING_CORNER_LOCATION[t][1]);return e})),a(p(c),"geographicToCartesian",(function(t,n,o,r){var i=e(t,n,t,r),a=e(t,n,o,n);return n*r>0?n>r&&(i*=-1):n<0&&r>0&&Math.abs(n-r)>180&&(i*=-1),t>o&&(a*=-1),c.toForgeCoordinate({x:i,y:a})})),a(p(c),"distance",(function(e,t,n,o){var r=e*Math.PI/180,i=n*Math.PI/180,a=(n-e)*Math.PI/180,s=(o-t)*Math.PI/180,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3})),c.viewer=t,c.options=u,c.container.classList.add("docking-panel-container-solid-color-a"),c.container.style.top="10px",c.container.style.left="10px",c.container.style.width="500px",c.container.style.padding="10px",c.container.style.height="700px",c.container.style.resize="auto",c.sceneBuilder=null,c.modelBuilder=null,c.input=null,c.inputValueDbId=null,c.inputPosX=null,c.inputPosY=null,c.inputPosZ=null,c.newGeo=null,c.tagId=null,c.centerLat=25.069771049083982,c.centerLong=121.52045303099948,c.angle=135,c.deviceX=4,c.deviceY=-5,c.BUILDING_CORNER_LOCATION=[[-4,5],[-4,-5],[4,-5],[4,5]],c.iconMapbox=[{url:"".concat("https://cdn.com","/assets/images/png/img_dasloop_pin_online.png"),id:"worker",longLat:[121.52045833593478,25.069785141828287]},{url:"".concat("https://cdn.com","/assets/images/png/img_gps_plant_pin_online.png"),id:"excavator",longLat:[121.5203549994178,25.069866644921674]}],c.positionRestrictedArea_X=-10,c.positionRestrictedArea_Y=5,c.restricAreaSize_X=1,c.restricAreaSize_Y=1,c.restricAreaSize_Z=1,c.positionExcavator_X=10,c.positionExcavator_Y=5,c.valueX=null,c.valueY=null,c.valueZ=null,c.humanModel1=null,c.excavator1=null,c.positionValue=null,c.positionUWB=null,c.datasAPI=null,c.infoDegree=null,c.infoDistance=null,c.infoWorkerPosition=null,c.viewer.loadExtension("Autodesk.Viewing.SceneBuilder").then((function(e){return c.sceneBuilder=e,c.sceneBuilder.addNewModel({modelNameOverride:"Beacon",conserveMemory:!1})})).then((function(e){c.modelBuilder=e,c.loadWorker(c.modelBuilder),console.log("modelBuilder Created.")})),c.newModel=new E(c.viewer,c.options),c.containerMapbox=document.createElement("div"),c.containerMapbox.setAttribute("id","map"),c.container.append(c.containerMapbox),mapboxgl.accessToken="pk.eyJ1IjoiYmVlaW52ZW50b3IiLCJhIjoiY2p1anFjbTY0MW9hMDRlcDRzMW9tcHJ1OSJ9.9WIfYAKd10XIdwWpB9EZFQ",c.map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[c.centerLong,c.centerLat]}),c.map.zoomTo(19.5),c.loadGLTFModel(),c.setNewWorker(),c.setNewRestrictedArea(),c.setNewBeacon(),c.setNewPlant(),c.setZoomToModel(),c.createInput(),c.setUpForm(),c.setVisibility(),c.setMapbox(),c.setDrawLine(),c.setDasloop(),c.lookAtMe(),c.setInfoDetails(),c}return u(l,[{key:"getDataUWB",value:function(){var e=this;setInterval((function(){fetch("http://localhost:8080/mqtt/mockdata").then((function(e){return e.json()})).then((function(t){e.workerPosition(t),e.tagId=t.tagId})).catch((function(e){return console.log(e)}))}),2e3)}},{key:"calculateUWBPosition",value:function(e,t,n,o,r){var i=e/100,a=(-n+t)*Math.PI/180,s=i*Math.cos(a),l=i*Math.sin(a);return[s+=o,l+=r]}},{key:"loadWorker",value:function(e){e&&(this.newModel.addNewWorker(e,parseInt(0xef4f9028120c3),0,0),this.newModel.addBeacon(e,parseInt(1),this.deviceX,this.deviceY),this.newModel.addRestrictedArea(e,parseInt(776),this.positionRestrictedArea_X,this.positionRestrictedArea_Y),this.newModel.addExcavator(e,parseInt(1234),this.positionExcavator_X,this.positionRestrictedArea_Y))}},{key:"loadGLTFModel",value:(o=i(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.glTF");case 2:return e.next=4,this.viewer.loadModel("/assets/models/excavator8.gltf",{},(function(e){console.log(e),t.excavator1=e}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"workerPosition",value:function(e){if(e){var t=this.calculateUWBPosition(e.distance,this.angle,e.degree,this.deviceX,this.deviceY),n=this.calculateLatLong(this.centerLat,this.centerLong,t[0],t[1]);this.updateDasloopPosition(n);var o=this.excavator1.getPlacementTransform();console.log(o.elements[12]),console.log(o.elements[13]),console.log(o.elements[14]);var r=this.calculateLatLong(this.centerLat,this.centerLong,o.elements[12],o.elements[13]);this.updateExcavatorPosition(r),this.setValueDetails(e.degree,e.distance,t,n[0],n[1]),this.newModel.changePositionSpecific(this.modelBuilder,e.tagId,t[0],t[1])}}},{key:"getBoxPositionEveryCorner",value:function(e,t,n,o,r,i,a){var s=n,l=o,u=2*r,c=2*i,d=[s-u/2,s-u/2,s+u/2,s+u/2],h=[l+c/2,l-c/2,l-c/2,l+c/2],m=this.getRotatedPosition(d,h,s,l,a);return this.toLatitudeLongitude(e,t,m)}},{key:"setNewWorker",value:function(){var e=this,t=document.createElement("div");t.innerText="New Create Model",t.classList.add("button-bee"),t.addEventListener("click",i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=4;break}e.newModel.addNewWorker(e.modelBuilder,parseInt(e.inputValueDbId)),t.next=6;break;case 4:return alert("Please input a number !"),t.abrupt("return",!1);case 6:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewRestrictedArea",value:function(){var e=this,t=document.createElement("div");t.innerText="New Restricted Area",t.classList.add("button-bee"),t.addEventListener("click",i(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),o=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addRestrictedArea(e.modelBuilder,parseInt(e.inputValueDbId),n,o),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewBeacon",value:function(){var e=this,t=document.createElement("div");t.innerText="New Beacon",t.classList.add("button-bee"),t.addEventListener("click",i(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),o=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addBeacon(e.modelBuilder,parseInt(e.inputValueDbId),n,o),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewPlant",value:function(){var e=this,t=document.createElement("div");t.innerText="New Plant",t.classList.add("button-bee"),t.addEventListener("click",i(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),o=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addExcavator(e.modelBuilder,parseInt(e.inputValueDbId),n,o),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setZoomToModel",value:function(){var e=this,t=document.createElement("div");t.innerText="Create Zoom To",t.classList.add("button-bee"),t.addEventListener("click",(function(){isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId?alert("Please input a number of dbId"):e.newModel.setFlyTo(e.modelBuilder,parseInt(e.inputValueDbId))})),this.container.append(t)}},{key:"createInput",value:function(){var e=this;this.input=document.createElement("input"),this.input.setAttribute("value",1234),this.input.addEventListener("input",(function(t){e.inputValueDbId=t.target.value})),this.container.append(this.input)}},{key:"setVisibility",value:function(){var e=this,t=document.createElement("div");t.innerText="Visibility",t.classList.add("button-bee"),t.addEventListener("click",i(regeneratorRuntime.mark((function t(){var n,o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.enabled=!e.enabled,e.enabled?(n=e.viewer.model.getData().instanceTree,o=n.getRootId(),e.viewer.hide(o)):(r=e.viewer.model.getData().instanceTree,i=r.getRootId(),e.viewer.show(i));case 2:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setUpForm",value:function(){var e=this,t=document.createElement("form");t.setAttribute("id","myform");var n=document.createElement("input"),o=document.createElement("input"),r=document.createElement("input");n.setAttribute("name","x"),o.setAttribute("name","y"),r.setAttribute("name","z");var i=document.createElement("input");i.setAttribute("type","submit"),i.innerText="submit_position",t.append(n,o,r,i),t.addEventListener("submit",(function(n){n.preventDefault(),e.valueX=parseInt(t.elements.namedItem("x").value),e.valueY=parseInt(t.elements.namedItem("y").value),e.valueZ=parseInt(t.elements.namedItem("z").value),e.inputValueDbId&&e.newModel.changePositionSpecific(e.modelBuilder,e.inputValueDbId,e.valueX,e.valueY,e.valueZ)})),this.container.append(t)}},{key:"setMapbox",value:function(){var e=this,t=document.createElement("input"),n=document.createElement("input");t.setAttribute("placeholder","Latitude"),n.setAttribute("placeholder","Longitude");var o=document.createElement("div");o.setAttribute("class","containerLatLong");var r=document.createElement("input"),i=document.createElement("input"),a=document.createElement("input");r.setAttribute("placeholder","x"),i.setAttribute("placeholder","y"),a.setAttribute("placeholder","z"),o.append(t,n,r,i,a),this.container.append(o),this.map.on("click",(function(o){var a=o.lngLat.lng,s=o.lngLat.lat;t.value=s,n.value=a;var l=e.geographicToCartesian(e.centerLat,e.centerLong,s,a);r.value=l.x,i.value=l.y,e.excavator1&&e.excavator1.setPlacementTransform((new THREE.Matrix4).setPosition({x:l.x,y:l.y,z:0}))}))}},{key:"toLatitudeLongitude",value:function(e,t,n){for(var o=[[0,0],[0,0],[0,0],[0,0]],r=0;r<n[0].length;r+=1)o[r]=this.calculateLatLong(e,t,n[0][r],n[1][r]);return o}},{key:"setInfoDetails",value:function(){var e=document.createElement("div");this.infoDegree=document.createElement("input"),this.infoDistance=document.createElement("input"),this.infoWorkerPosition=document.createElement("input"),this.long=document.createElement("input"),this.lat=document.createElement("input"),e.append(this.infoDegree,this.infoDistance,this.infoWorkerPosition,this.long,this.lat),this.container.append(e)}},{key:"setValueDetails",value:function(e,t,n,o,r){this.infoDegree.value=parseFloat(e).toFixed(2),this.infoDistance.value=t,this.infoWorkerPosition.value="(".concat(parseFloat(n[0]).toFixed(2),", ").concat(parseFloat(n[1]).toFixed(2),")"),this.long.value=o,this.lat.value=r}},{key:"setDasloop",value:function(){var e=this;this.map.on("load",(function(){Promise.all(e.iconMapbox.map((function(t){return new Promise((function(n,o){e.map.loadImage(t.url,(function(e,r){e?(console.log("Error with ".concat(t.id)),console.error(e),o(e)):n([t,r])}))}))}))).then((function(t){t.forEach((function(t){var n=t[0],o=t[1];o&&e.map.addImage(n.id,o),e.map.addSource(n.id,{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[n.longLat[0],n.longLat[1]]},properties:{}}]}}),e.map.addLayer({id:n.id,type:"symbol",source:n.id,layout:{"icon-image":n.id,"icon-size":.1,"icon-offset":[0,-150],"icon-allow-overlap":!0}})}))}))}))}},{key:"updateDasloopPosition",value:function(e){if(e){var t={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e[0],e[1]]},properties:{}}]},n=this.map.getSource("worker");n&&n.setData(t)}}},{key:"updateExcavatorPosition",value:function(e){if(e){var t={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e[0],e[1]]},properties:{}}]},n=this.map.getSource("excavator");n&&n.setData(t)}}},{key:"setDrawLine",value:function(){var e=this;this.map.on("load",(function(){var t=e.setCoordinateBuilding();e.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[].concat(n(t.map((function(e){return e}))),[t[0]])}}}),e.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4}});var o=e.getBoxPositionEveryCorner(e.centerLat,e.centerLong,e.positionRestrictedArea_X,e.positionRestrictedArea_Y,e.restricAreaSize_X,e.restricAreaSize_Y,0);e.map.addSource("route2",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[].concat(n(o.map((function(e){return e}))),[o[0]])}}}),e.map.addLayer({id:"route2",type:"line",source:"route2",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4}})}))}},{key:"lookAtMe",value:function(){var e=this,t=document.createElement("div");t.classList.add("button-bee"),t.innerText="Change Scale",t.addEventListener("click",(function(){e.newModel.restrictedAreaScale(parseInt(776),e.modelBuilder,e.restricAreaSize_X,e.restricAreaSize_Y)})),this.container.append(t)}},{key:"toForgeCoordinate",value:function(e){return{x:e.x,y:e.y}}}]),l}(),E=function(){function e(t,n){s(this,e),this.viewer=t,this.options=n,this.position=null,this.workerId=null,this.model=null,this.humanModel=null,this.restrictedArea=null,this.beacon=null,this.excavator=null,this.objects={}}return u(e,[{key:"addWorker",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=new THREE.Geometry,a=new THREE.MeshBasicMaterial({color:16711680}),s=THREE.ImageUtils.loadTexture("".concat("https://cdn.com","/assets/images/png/img_gps_dasloop_online.png"));s.minFilter=THREE.LinearFilter;var l=new THREE.MeshBasicMaterial({map:s,side:THREE.DoubleSide}),u=new THREE.PlaneGeometry(1,1),c=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3});c.computeBoundingBox();var d=new THREE.Mesh(c,a),h=new THREE.Mesh(u,l);d.matrix.setPosition(new THREE.Vector3(-1.5,.7,0)),d.matrix.scale(new THREE.Vector3(.2,.2,.2)),i.merge(h.geometry,h.matrix),i.merge(d.geometry,d.matrix),i.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(i);this.humanModel=new THREE.Mesh(m,l),this.humanModel.matrix.setPosition(new THREE.Vector3(n,o,r)),this.humanModel.userData.id=t,this.objects[this.humanModel.userData.id]=this.humanModel,this.humanModel.dbId=t,e.addMesh(this.humanModel)}},{key:"addNewWorker",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.Geometry,a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.SphereGeometry(.4,32,16),l=new THREE.SphereGeometry(.3,32,16),u=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),c=new THREE.Mesh(u,a);c.matrix.setPosition(new THREE.Vector3(0,0,1.3)),c.matrix.scale(new THREE.Vector3(.2,.2,.2));var d=new THREE.Mesh(s,a),h=new THREE.Mesh(l,a);d.matrix.setPosition(new THREE.Vector3(0,0,1)),d.matrix.scale(new THREE.Vector3(.5,.5,.5)),h.matrix.scale(new THREE.Vector3(.5,.5,2.5)),i.merge(d.geometry,d.matrix),i.merge(h.geometry,h.matrix),i.merge(c.geometry,c.matrix),i.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(i);this.humanModel=new THREE.Mesh(m,a),this.humanModel.matrix.setPosition(new THREE.Vector3(n,o,r)),this.humanModel.userData.id=t,this.objects[this.humanModel.userData.id]=this.humanModel,this.humanModel.dbId=t,e.addMesh(this.humanModel),this.model=this.modelBuilder}},{key:"addRestrictedArea",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=new THREE.BoxGeometry(1,1,1),a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),l=new THREE.Geometry,u=new THREE.Mesh(i,a),c=new THREE.Mesh(s,a);c.matrix.setPosition(new THREE.Vector3(0,.5,0)),c.matrix.scale(new THREE.Vector3(.2,.2,.2)),u.matrix.scale(new THREE.Vector3(1,1,1)),l.merge(u.geometry,u.matrix),l.merge(c.geometry,c.matrix),l.computeVertexNormals();var d=(new THREE.BufferGeometry).fromGeometry(l);this.restrictedArea=new THREE.Mesh(d,a),this.restrictedArea.matrix.setPosition(new THREE.Vector3(n,o,r)),this.restrictedArea.userData.id=t,this.objects[this.restrictedArea.userData.id]=this.restrictedArea,this.restrictedArea.dbId=t,e.addMesh(this.restrictedArea)}},{key:"addExcavator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.MeshBasicMaterial({color:"#ff9500"}),a=THREE.ImageUtils.loadTexture("".concat("https://cdn.com","/assets/images/png/img_gps_plant_online-3.png"));a.minFilter=THREE.LinearFilter;var s=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide}),l=new THREE.BoxGeometry(1,1,1),u=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3});u.computeBoundingBox();var c=new THREE.Mesh(u,i),d=new THREE.Mesh(l,i);d.matrix.scale(new THREE.Vector3(2,2,1)),c.matrix.setPosition(new THREE.Vector3(0,1,0)),c.matrix.scale(new THREE.Vector3(.2,.2,.2));var h=new THREE.Geometry;h.merge(c.geometry,c.matrix),h.merge(d.geometry,d.matrix),h.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(h);this.excavator=new THREE.Mesh(m,s),this.excavator.matrix.setPosition(new THREE.Vector3(n,o,r)),this.excavator.userData.id=t,this.objects[this.excavator.userData.id]=this.excavator,this.excavator.dbId=t,e.addMesh(this.excavator)}},{key:"addBeacon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.SphereGeometry(.3,32,16),a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),l=new THREE.Mesh(s,a),u=new THREE.Mesh(i,a);l.matrix.setPosition(new THREE.Vector3(0,.5,0)),l.matrix.scale(new THREE.Vector3(.2,.2,.2));var c=new THREE.Geometry;c.merge(l.geometry,l.matrix),c.merge(u.geometry,u.matrix),c.computeVertexNormals();var d=(new THREE.BufferGeometry).fromGeometry(c);this.beacon=new THREE.Mesh(d,a),this.beacon.matrix.setPosition(new THREE.Vector3(n,o,r)),this.beacon.userData.id=t,this.objects[this.beacon.userData.id]=this.beacon,this.beacon.dbId=t,e.addMesh(this.beacon)}},{key:"setFlyTo",value:function(e,t){this.viewer.select([t],e.model),this.viewer.utilities.fitToView()}},{key:"changePosition",value:function(e,t,n,o,r){console.log(t),t.matrix.setPosition(new THREE.Vector3(n,o,r)),e.updateMesh(t)}},{key:"changePositionSpecific",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.objects[t]?(this.objects[t].matrix.setPosition(new THREE.Vector3(n,o,r)),e.updateMesh(this.objects[t])):console.log("there is no object on this scene !")}},{key:"restrictedAreaScale",value:function(e,t,n,o){this.objects[e]?(this.objects[e].matrix.scale(new THREE.Vector3(n,o,1)),t.updateMesh(this.objects[e])):console.log("there is no object on this scene !")}},{key:"lookAtMe",value:function(e,t){console.log(e),this.objects[t].matrix.makeRotationFromQuaternion(this.viewer.getCamera().clone().quaternion),e.updateMesh(this.objects[t])}}]),e}()})();
//# sourceMappingURL=main.js.map