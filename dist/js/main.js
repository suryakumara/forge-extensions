(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n=function(){function n(e,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"R",6371e3),t(this,"center",{longitude,latitude}),t(this,"distance",(function(e,t){var r=n.degreeToRadian(o.center.latitude),i=n.degreeToRadian(e),a=n.degreeToRadian(e-o.center.latitude),s=n.degreeToRadian(o.center.longitude),u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2),l=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u));return o.R*l})),t(this,"geographicToCartesian",(function(e,t,n,r){var i=o.distance(e,t,e,r),a=o.distance(e,t,n,t);return t*r>0?(console.log(t*r),t>r&&(i*=-1)):t<0&&r>0&&Math.abs(t-r)>180&&(i*=-1),e>n&&(a*=-1),toForgeCoordinate({x:i,y:a})})),t(this,"cartesianToGeographic",(function(e,t){var n=Math.PI,r=e/1e3,i=t/1e3;return{latitude:o.center.latitude+i/o.R*(180/n),longitude:o.center.longitude+r/o.R*(180/n)/Math.cos(o.center.latitude*n/180)}})),this.center={latitude:e,longitude:r}}var r,o,i;return r=n,i=[{key:"degreeToRadian",value:function(e){return e*Math.PI/180}},{key:"forgeCoodinateToCartesianCoordinate",value:function(e){return{x:e[0],y:e[1],z:e[2]}}},{key:"toForgeCoordinate",value:function(e){return{x:e.x,y:e.y}}}],(o=[{key:"getCenter",value:function(){return this.center}},{key:"setCenter",value:function(e,t){this.cente={latitude:e,longitude:t}}}])&&e(r.prototype,o),i&&e(r,i),n}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,u,"next",e)}function u(e){a(i,r,o,s,u,"throw",e)}s(void 0)}))}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g(e);if(t){var o=g(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return v(this,n)}}function v(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return f(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var E=function(e){h(n,Autodesk.Viewing.Extension);var t=p(n);function n(e,r){var o;return l(this,n),(o=t.call(this,e,r)).viewer=e,o.options=r,o._button=null,o._group=null,o.panel=null,o.grid=null,o}return d(n,[{key:"load",value:function(){return console.log("Docking Panel has been loaded !"),this.grid=new THREE.GridHelper(50,1),this.grid.material.opacity=.8,this.grid.material.transparent=!0,this.grid.position.set(0,0,0),this.grid.rotateX(Math.PI/2),this.viewer.overlays.hasScene("grid")||this.viewer.overlays.addScene("grid"),this.viewer.overlays.addMesh(this.grid,"grid"),!0}},{key:"unload",value:function(){return console.log("Docking Panel has been unloaded !"),null!==this.viewer.toolbar&&this.viewer.toolbar.removeControl(this.subToolbar),null!==this.panel&&this.panel.setVisible(!1),this._group&&(this._group.removeControl(this._button),0===this._group.getNumberOfControls()&&this.viewer.toolbar.removeControl(this._group)),!0}},{key:"onToolbarCreated",value:function(){var e=this;this._group=this.viewer.toolbar.getControl("BeeInventorToolbar"),this._group||(this._group=new Autodesk.Viewing.UI.ControlGroup("BeeInventorToolbar"),this.viewer.toolbar.addControl(this._group)),this._button=new Autodesk.Viewing.UI.Button("Docking Panel"),this._button.onClick=function(){null===e.panel&&(e.panel=new y(e.viewer,e.viewer.container,"beeInventor","My Custom Extension")),e.panel.setVisible(!e.panel.isVisible())},this._button.setToolTip("BeeInventor IoT"),this._button.addClass("dockingPanel"),this._group.addControl(this._button)}}]),n}();Autodesk.Viewing.theExtensionManager.registerExtension("BeeInventor",E);var y=function(e){h(a,Autodesk.Viewing.UI.DockingPanel);var t,r,i=p(a);function a(e,t,r,o,s){var c;return l(this,a),u(f(c=i.call(this,t,r,o,s)),"multiplyMatrix",(function(e,t){for(var n=e.length,r=e[0].length,o=t[0].length,i=new Array(n),a=0;a<n;a+=1){i[a]=new Array(o);for(var s=0;s<o;s+=1){i[a][s]=0;for(var u=0;u<r;u+=1)i[a][s]+=e[a][u]*t[u][s]}}return i})),u(f(c),"getRotatedPosition",(function(e,t,n,r,o){var i=[e,t,[1,1,1,1]],a=[[1,0,-n],[0,1,-r],[0,0,1]],s=o*(Math.PI/180),u=[[Math.cos(s),-Math.sin(s),0],[Math.sin(s),Math.cos(s),0],[0,0,1]],l=[[1,0,n],[0,1,r],[0,0,1]],d=c.multiplyMatrix(l,u),h=c.multiplyMatrix(d,a);return[(i=c.multiplyMatrix(h,i))[0],i[1]]})),u(f(c),"calculateLatLong",(function(e,t,n,r){var o=Math.PI,i=e+r/1e3/6378*(180/o);return[t+n/1e3/6378*(180/o)/Math.cos(e*o/180),i]})),u(f(c),"setCoordinateBuilding",(function(){for(var e=[[0,0],[0,0],[0,0],[0,0]],t=0;t<c.BUILDING_CORNER_LOCATION.length;t+=1)e[t]=c.calculateLatLong(c.centerLat,c.centerLong,c.BUILDING_CORNER_LOCATION[t][0],c.BUILDING_CORNER_LOCATION[t][1]);return e})),u(f(c),"distance",(function(e,t,n,r){var o=e*Math.PI/180,i=n*Math.PI/180,a=(n-e)*Math.PI/180,s=(r-t)*Math.PI/180,u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(o)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3})),c.viewer=e,c.options=s,c.container.classList.add("docking-panel-container-solid-color-a"),c.container.style.top="10px",c.container.style.left="10px",c.container.style.width="500px",c.container.style.padding="10px",c.container.style.height="700px",c.container.style.resize="auto",c.sceneBuilder=null,c.modelBuilder=null,c.input=null,c.inputValueDbId=null,c.inputPosX=null,c.inputPosY=null,c.inputPosZ=null,c.newGeo=null,c.tagId=null,c.coordinateConverter=new n(25.069771049083982,121.52045303099948),c.centerLat=25.069771049083982,c.centerLong=121.52045303099948,c.angle=135,c.deviceX=4,c.deviceY=-5,c.BUILDING_CORNER_LOCATION=[[-4,5],[-4,-5],[4,-5],[4,5]],c.iconMapbox=[{url:"".concat("https://cdn.com","/assets/images/png/img_dasloop_pin_online.png"),id:"worker",longLat:[121.52045833593478,25.069785141828287]},{url:"".concat("https://cdn.com","/assets/images/png/img_gps_plant_pin_online.png"),id:"excavator",longLat:[121.5203549994178,25.069866644921674]}],c.positionRestrictedArea_X=-10,c.positionRestrictedArea_Y=5,c.restricAreaSize_X=1,c.restricAreaSize_Y=1,c.restricAreaSize_Z=1,c.positionExcavator_X=10,c.positionExcavator_Y=5,c.valueX=null,c.valueY=null,c.valueZ=null,c.human=null,c.plant=null,c.positionValue=null,c.positionUWB=null,c.datasAPI=null,c.infoDegree=null,c.infoDistance=null,c.infoWorkerPosition=null,c.viewer.loadExtension("Autodesk.Viewing.SceneBuilder").then((function(e){return c.sceneBuilder=e,c.sceneBuilder.addNewModel({modelNameOverride:"Beacon",conserveMemory:!1})})).then((function(e){c.modelBuilder=e,c.loadWorker(c.modelBuilder),console.log("modelBuilder Created.")})),c.viewer.loadExtension("Autodesk.glTF"),c.newModel=new w(c.viewer,c.options),c.containerMapbox=document.createElement("div"),c.containerMapbox.setAttribute("id","map"),c.container.append(c.containerMapbox),mapboxgl.accessToken="pk.eyJ1IjoiYmVlaW52ZW50b3IiLCJhIjoiY2p1anFjbTY0MW9hMDRlcDRzMW9tcHJ1OSJ9.9WIfYAKd10XIdwWpB9EZFQ",c.map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[c.centerLong,c.centerLat]}),c.map.zoomTo(19.5),c.loadPlantModel(),c.loadWorkerModel(),c.getDataUWB(),c.setNewWorker(),c.setNewRestrictedArea(),c.setNewBeacon(),c.setNewPlant(),c.setZoomToModel(),c.createInput(),c.setUpForm(),c.setVisibility(),c.setMapbox(),c.setDrawLine(),c.setDasloop(),c.lookAtMe(),c.setInfoDetails(),c}return d(a,[{key:"getDataUWB",value:function(){var e=this;setInterval((function(){fetch("http://localhost:8080/mqtt/mockdata").then((function(e){return e.json()})).then((function(t){e.workerPosition(t),e.tagId=t.tagId})).catch((function(e){return console.log(e)}))}),2e3)}},{key:"calculateUWBPosition",value:function(e,t,n,r,o){var i=e/100,a=(-n+t)*Math.PI/180,s=i*Math.cos(a),u=i*Math.sin(a);return[s+=r,u+=o]}},{key:"loadWorker",value:function(e){e&&(this.newModel.addWorkerTag(e,parseInt(1),0,0),this.newModel.addBeacon(e,parseInt(123),this.deviceX,this.deviceY),this.newModel.addRestrictedArea(e,parseInt(776),this.positionRestrictedArea_X,this.positionRestrictedArea_Y),this.newModel.addExcavator(e,parseInt(1234),this.positionExcavator_X,this.positionExcavator_Y))}},{key:"loadPlantModel",value:(r=s(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadModel("".concat("https://cdn.com","/assets/models/excavator.gltf"),{},(function(e){t.plant=e}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"loadWorkerModel",value:(t=s(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadModel("".concat("https://cdn.com","/assets/models/human.gltf"),{},(function(e){t.human=e}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"workerPosition",value:function(e){if(e){var t=this.calculateUWBPosition(e.distance,this.angle,e.degree,this.deviceX,this.deviceY),n=this.calculateLatLong(this.centerLat,this.centerLong,t[0],t[1]);this.updateDasloopPosition(n);var r=this.plant.getPlacementTransform(),o=this.calculateLatLong(this.centerLat,this.centerLong,r.elements[12],r.elements[13]);this.updateExcavatorPosition(o),this.setValueDetails(e.degree,e.distance,t,n[0],n[1]),this.newModel.changePositionSpecific(this.modelBuilder,parseInt(1),t[0],t[1]),this.human&&this.human.setPlacementTransform((new THREE.Matrix4).setPosition({x:t[0],y:t[1],z:0}))}}},{key:"getBoxPositionEveryCorner",value:function(e,t,n,r,o,i,a){var s=n,u=r,l=2*o,c=2*i,d=[s-l/2,s-l/2,s+l/2,s+l/2],h=[u+c/2,u-c/2,u-c/2,u+c/2],m=this.getRotatedPosition(d,h,s,u,a);return this.toLatitudeLongitude(e,t,m)}},{key:"setNewWorker",value:function(){var e=this,t=document.createElement("div");t.innerText="New Create Model",t.classList.add("button-bee"),t.addEventListener("click",s(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=4;break}e.newModel.addNewWorker(e.modelBuilder,parseInt(e.inputValueDbId)),t.next=6;break;case 4:return alert("Please input a number !"),t.abrupt("return",!1);case 6:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewRestrictedArea",value:function(){var e=this,t=document.createElement("div");t.innerText="New Restricted Area",t.classList.add("button-bee"),t.addEventListener("click",s(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),r=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addRestrictedArea(e.modelBuilder,parseInt(e.inputValueDbId),n,r),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewBeacon",value:function(){var e=this,t=document.createElement("div");t.innerText="New Beacon",t.classList.add("button-bee"),t.addEventListener("click",s(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),r=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addBeacon(e.modelBuilder,parseInt(e.inputValueDbId),n,r),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setNewPlant",value:function(){var e=this,t=document.createElement("div");t.innerText="New Plant",t.classList.add("button-bee"),t.addEventListener("click",s(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.floor(100*Math.random()),r=Math.floor(100*Math.random()),isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId){t.next=6;break}e.newModel.addExcavator(e.modelBuilder,parseInt(e.inputValueDbId),n,r),t.next=8;break;case 6:return alert("Please input a number of dbId!"),t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setZoomToModel",value:function(){var e=this,t=document.createElement("div");t.innerText="Create Zoom To",t.classList.add("button-bee"),t.addEventListener("click",(function(){isNaN(e.inputValueDbId)||""===e.inputValueDbId||null===e.inputValueDbId?alert("Please input a number of dbId"):e.newModel.setFlyTo(e.modelBuilder,parseInt(e.inputValueDbId))})),this.container.append(t)}},{key:"createInput",value:function(){var e=this;this.input=document.createElement("input"),this.input.setAttribute("value",1234),this.input.addEventListener("input",(function(t){e.inputValueDbId=t.target.value})),this.container.append(this.input)}},{key:"setVisibility",value:function(){var e=this,t=document.createElement("div");t.innerText="Visibility",t.classList.add("button-bee"),t.addEventListener("click",s(regeneratorRuntime.mark((function t(){var n,r,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.enabled=!e.enabled,e.enabled?(n=e.viewer.model.getData().instanceTree,r=n.getRootId(),e.viewer.hide(r)):(o=e.viewer.model.getData().instanceTree,i=o.getRootId(),e.viewer.show(i));case 2:case"end":return t.stop()}}),t)})))),this.container.append(t)}},{key:"setUpForm",value:function(){var e=this,t=document.createElement("form");t.setAttribute("id","myform");var n=document.createElement("input"),r=document.createElement("input"),o=document.createElement("input");n.setAttribute("name","x"),r.setAttribute("name","y"),o.setAttribute("name","z");var i=document.createElement("input");i.setAttribute("type","submit"),i.innerText="submit_position",t.append(n,r,o,i),t.addEventListener("submit",(function(n){n.preventDefault(),e.valueX=parseInt(t.elements.namedItem("x").value),e.valueY=parseInt(t.elements.namedItem("y").value),e.valueZ=parseInt(t.elements.namedItem("z").value),e.inputValueDbId&&e.newModel.changePositionSpecific(e.modelBuilder,e.inputValueDbId,e.valueX,e.valueY,e.valueZ)})),this.container.append(t)}},{key:"setMapbox",value:function(){var e=this,t=document.createElement("input"),n=document.createElement("input");t.setAttribute("placeholder","Latitude"),n.setAttribute("placeholder","Longitude");var r=document.createElement("div");r.setAttribute("class","containerLatLong");var o=document.createElement("input"),i=document.createElement("input"),a=document.createElement("input");o.setAttribute("placeholder","x"),i.setAttribute("placeholder","y"),a.setAttribute("placeholder","z"),r.append(t,n,o,i,a),this.container.append(r),this.map.on("click",(function(r){var a=r.lngLat.lng,s=r.lngLat.lat;t.value=s,n.value=a;var u=e.coordinateConverter.geographicToCartesian(s,a);o.value=u.x,i.value=u.y,e.plant&&e.plant.setPlacementTransform((new THREE.Matrix4).setPosition({x:u.x,y:u.y,z:0}))}))}},{key:"toLatitudeLongitude",value:function(e,t,n){for(var r=[[0,0],[0,0],[0,0],[0,0]],o=0;o<n[0].length;o+=1)r[o]=this.calculateLatLong(e,t,n[0][o],n[1][o]);return r}},{key:"setInfoDetails",value:function(){var e=document.createElement("div");this.infoDegree=document.createElement("input"),this.infoDistance=document.createElement("input"),this.infoWorkerPosition=document.createElement("input"),this.long=document.createElement("input"),this.lat=document.createElement("input"),e.append(this.infoDegree,this.infoDistance,this.infoWorkerPosition,this.long,this.lat),this.container.append(e)}},{key:"setValueDetails",value:function(e,t,n,r,o){this.infoDegree.value=parseFloat(e).toFixed(2),this.infoDistance.value=t,this.infoWorkerPosition.value="(".concat(parseFloat(n[0]).toFixed(2),", ").concat(parseFloat(n[1]).toFixed(2),")"),this.long.value=r,this.lat.value=o}},{key:"setDasloop",value:function(){var e=this;this.map.on("load",(function(){Promise.all(e.iconMapbox.map((function(t){return new Promise((function(n,r){e.map.loadImage(t.url,(function(e,o){e?(console.log("Error with ".concat(t.id)),console.error(e),r(e)):n([t,o])}))}))}))).then((function(t){t.forEach((function(t){var n=t[0],r=t[1];r&&e.map.addImage(n.id,r),e.map.addSource(n.id,{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[n.longLat[0],n.longLat[1]]},properties:{}}]}}),e.map.addLayer({id:n.id,type:"symbol",source:n.id,layout:{"icon-image":n.id,"icon-size":.1,"icon-offset":[0,-150],"icon-allow-overlap":!0}})}))}))}))}},{key:"updateDasloopPosition",value:function(e){if(e){var t={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e[0],e[1]]},properties:{}}]},n=this.map.getSource("worker");n&&n.setData(t)}}},{key:"updateExcavatorPosition",value:function(e){if(e){var t={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[e[0],e[1]]},properties:{}}]},n=this.map.getSource("excavator");n&&n.setData(t)}}},{key:"setDrawLine",value:function(){var e=this;this.map.on("load",(function(){var t=e.setCoordinateBuilding();e.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[].concat(o(t.map((function(e){return e}))),[t[0]])}}}),e.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4}});var n=e.getBoxPositionEveryCorner(e.centerLat,e.centerLong,e.positionRestrictedArea_X,e.positionRestrictedArea_Y,e.restricAreaSize_X,e.restricAreaSize_Y,0);e.map.addSource("route2",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[].concat(o(n.map((function(e){return e}))),[n[0]])}}}),e.map.addLayer({id:"route2",type:"line",source:"route2",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4}})}))}},{key:"lookAtMe",value:function(){var e=this,t=document.createElement("div");t.classList.add("button-bee"),t.innerText="Change Scale",t.addEventListener("click",(function(){e.newModel.restrictedAreaScale(parseInt(776),e.modelBuilder,e.restricAreaSize_X,e.restricAreaSize_Y)})),this.container.append(t)}},{key:"toForgeCoordinate",value:function(e){return{x:e.x,y:e.y}}}]),a}(),w=function(){function e(t,n){l(this,e),this.viewer=t,this.options=n,this.position=null,this.workerId=null,this.workerTagId=null,this.model=null,this.humanModel=null,this.restrictedArea=null,this.beacon=null,this.excavator=null,this.objects={}}return d(e,[{key:"addWorker",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=new THREE.Geometry,a=new THREE.MeshBasicMaterial({color:16711680}),s=THREE.ImageUtils.loadTexture("".concat("https://cdn.com","/assets/images/png/img_gps_dasloop_online.png"));s.minFilter=THREE.LinearFilter;var u=new THREE.MeshBasicMaterial({map:s,side:THREE.DoubleSide}),l=new THREE.PlaneGeometry(1,1),c=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3});c.computeBoundingBox();var d=new THREE.Mesh(c,a),h=new THREE.Mesh(l,u);d.matrix.setPosition(new THREE.Vector3(-1.5,.7,0)),d.matrix.scale(new THREE.Vector3(.2,.2,.2)),i.merge(h.geometry,h.matrix),i.merge(d.geometry,d.matrix),i.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(i);this.humanModel=new THREE.Mesh(m,u),this.humanModel.matrix.setPosition(new THREE.Vector3(n,r,o)),this.humanModel.userData.id=t,this.objects[this.humanModel.userData.id]=this.humanModel,this.humanModel.dbId=t,e.addMesh(this.humanModel)}},{key:"addWorkerTag",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.Geometry,a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.SphereGeometry(.4,32,16),u=new THREE.TextGeometry("worker:".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),l=new THREE.Mesh(u,a);l.matrix.setPosition(new THREE.Vector3(0,0,1.3)),l.matrix.scale(new THREE.Vector3(.2,.2,.2));var c=new THREE.Mesh(s,a);c.matrix.setPosition(new THREE.Vector3(0,0,1)),c.matrix.scale(new THREE.Vector3(.2,.2,.2)),i.merge(c.geometry,c.matrix),i.merge(l.geometry,l.matrix),i.computeVertexNormals();var d=(new THREE.BufferGeometry).fromGeometry(i);this.workerTagId=new THREE.Mesh(d,a),this.workerTagId.matrix.setPosition(new THREE.Vector3(n,r,o)),this.workerTagId.userData.id=t,this.objects[this.workerTagId.userData.id]=this.workerTagId,this.workerTagId.dbId=t,e.addMesh(this.workerTagId)}},{key:"addNewWorker",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.Geometry,a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.SphereGeometry(.4,32,16),u=new THREE.SphereGeometry(.3,32,16),l=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),c=new THREE.Mesh(l,a);c.matrix.setPosition(new THREE.Vector3(0,0,1.3)),c.matrix.scale(new THREE.Vector3(.2,.2,.2));var d=new THREE.Mesh(s,a),h=new THREE.Mesh(u,a);d.matrix.setPosition(new THREE.Vector3(0,0,1)),d.matrix.scale(new THREE.Vector3(.5,.5,.5)),h.matrix.scale(new THREE.Vector3(.5,.5,2.5)),i.merge(d.geometry,d.matrix),i.merge(h.geometry,h.matrix),i.merge(c.geometry,c.matrix),i.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(i);this.humanModel=new THREE.Mesh(m,a),this.humanModel.matrix.setPosition(new THREE.Vector3(n,r,o)),this.humanModel.userData.id=t,this.objects[this.humanModel.userData.id]=this.humanModel,this.humanModel.dbId=t,e.addMesh(this.humanModel),this.model=this.modelBuilder}},{key:"addRestrictedArea",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=new THREE.BoxGeometry(1,1,1),a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),u=new THREE.Geometry,l=new THREE.Mesh(i,a),c=new THREE.Mesh(s,a);c.matrix.setPosition(new THREE.Vector3(0,.5,0)),c.matrix.scale(new THREE.Vector3(.2,.2,.2)),l.matrix.scale(new THREE.Vector3(1,1,1)),u.merge(l.geometry,l.matrix),u.merge(c.geometry,c.matrix),u.computeVertexNormals();var d=(new THREE.BufferGeometry).fromGeometry(u);this.restrictedArea=new THREE.Mesh(d,a),this.restrictedArea.matrix.setPosition(new THREE.Vector3(n,r,o)),this.restrictedArea.userData.id=t,this.objects[this.restrictedArea.userData.id]=this.restrictedArea,this.restrictedArea.dbId=t,e.addMesh(this.restrictedArea)}},{key:"addExcavator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.MeshBasicMaterial({color:"#ff9500"}),a=THREE.ImageUtils.loadTexture("".concat("https://cdn.com","/assets/images/png/img_gps_plant_online-3.png"));a.minFilter=THREE.LinearFilter;var s=new THREE.MeshBasicMaterial({map:a,side:THREE.DoubleSide}),u=new THREE.BoxGeometry(1,1,1),l=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3});l.computeBoundingBox();var c=new THREE.Mesh(l,i),d=new THREE.Mesh(u,i);d.matrix.scale(new THREE.Vector3(2,2,1)),c.matrix.setPosition(new THREE.Vector3(0,1,0)),c.matrix.scale(new THREE.Vector3(.2,.2,.2));var h=new THREE.Geometry;h.merge(c.geometry,c.matrix),h.merge(d.geometry,d.matrix),h.computeVertexNormals();var m=(new THREE.BufferGeometry).fromGeometry(h);this.excavator=new THREE.Mesh(m,s),this.excavator.matrix.setPosition(new THREE.Vector3(n,r,o)),this.excavator.userData.id=t,this.objects[this.excavator.userData.id]=this.excavator,this.excavator.dbId=t,e.addMesh(this.excavator)}},{key:"addBeacon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=new THREE.SphereGeometry(.3,32,16),a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.TextGeometry("".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),u=new THREE.Mesh(s,a),l=new THREE.Mesh(i,a);u.matrix.setPosition(new THREE.Vector3(0,.5,0)),u.matrix.scale(new THREE.Vector3(.2,.2,.2));var c=new THREE.Geometry;c.merge(u.geometry,u.matrix),c.merge(l.geometry,l.matrix),c.computeVertexNormals();var d=(new THREE.BufferGeometry).fromGeometry(c);this.beacon=new THREE.Mesh(d,a),this.beacon.matrix.setPosition(new THREE.Vector3(n,r,o)),this.beacon.userData.id=t,this.objects[this.beacon.userData.id]=this.beacon,this.beacon.dbId=t,e.addMesh(this.beacon)}},{key:"setFlyTo",value:function(e,t){this.viewer.select([t],e.model),this.viewer.utilities.fitToView()}},{key:"changePosition",value:function(e,t,n,r,o){console.log(t),t.matrix.setPosition(new THREE.Vector3(n,r,o)),e.updateMesh(t)}},{key:"changePositionSpecific",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.objects[t]?(this.objects[t].matrix.setPosition(new THREE.Vector3(n,r,o)),e.updateMesh(this.objects[t])):console.log("there is no object on this scene !")}},{key:"restrictedAreaScale",value:function(e,t,n,r){this.objects[e]?(this.objects[e].matrix.scale(new THREE.Vector3(n,r,1)),t.updateMesh(this.objects[e])):console.log("there is no object on this scene !")}},{key:"lookAtMe",value:function(e,t){console.log(e),this.objects[t].matrix.makeRotationFromQuaternion(this.viewer.getCamera().clone().quaternion),e.updateMesh(this.objects[t])}}]),e}()})();
//# sourceMappingURL=main.js.map